function mostrarTokenInvalido(e,o){Swal.fire({icon:"error",title:"Token inválido",html:`\n      <p>${e}</p>\n      <input id="correoReenvio" type="email" placeholder="Introduce tu correo" value="${o||""}" class="swal2-input">\n    `,confirmButtonText:"Reenviar correo",customClass:{popup:"mi-popup-central",icon:"swal-icon-center"},preConfirm:()=>{const e=$("#correoReenvio").val();return e&&/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i.test(e)?$.ajax({url:"./Modules/Global/Controllers/TokenValidator.php",type:"GET",data:{type:"resend_email",email:e},dataType:"json"}).then((e=>(e.success||Swal.showValidationMessage(e.message||"Error al reenviar"),e))).catch((()=>{Swal.showValidationMessage("Error inesperado al contactar con el servidor")})):(Swal.showValidationMessage("Por favor introduce un correo válido y bien formado"),!1)}}).then((e=>{e.isConfirmed&&e.value?.success&&Swal.fire({icon:"success",title:"Correo reenviado",text:e.value.message||"Te hemos enviado un nuevo correo de verificación.",confirmButtonText:"OK",customClass:{popup:"mi-popup-central",icon:"swal-icon-center"}})}))}jQuery((function(){const e=new URLSearchParams(window.location.search),o=e.get("token"),t=e.get("type")||"autologin",a=e.get("email");o&&t&&a&&$.ajax({url:"./Modules/Global/Controllers/TokenValidator.php",type:"GET",data:{token:o,type:t},dataType:"json",success:function(e){e.success?Swal.fire({icon:"success",title:e.title,text:e.message,confirmButtonText:"OK",confirmButtonColor:"#4CAF50",customClass:{popup:"mi-popup-central"}}).then((()=>{localStorage.setItem("abrirOffcanvas","1"),window.location.href="/inicio"})):"already_verified"===e.code?Swal.fire({icon:"warning",title:"¡Correo ya verificado!",text:e.message,confirmButtonText:"Entendido",confirmButtonColor:"#f4b400",customClass:{popup:"mi-popup-central"}}).then((()=>{window.location.href="/inicio"})):"error_mail"===e.code?Swal.fire({icon:"error",title:"Error al enviar el correo",text:e.message,confirmButtonText:"Entendido",confirmButtonColor:"#f4b400",customClass:{popup:"mi-popup-central"}}).then((()=>{window.location.href="/inicio"})):"expired"===e.code?mostrarTokenInvalido(e.message,a):"recover"===e.code?(Swal.fire({title:"Nueva contraseña",html:`\n              <p>Introduce una nueva contraseña para <strong>${a}</strong></p>\n              <input type="password" id="pass1" class="swal2-input" placeholder="Nueva contraseña">\n              <input type="password" id="pass2" class="swal2-input" placeholder="Repite la contraseña">\n              <div id="errorText" style="color:red; font-size: 0.9em; display:none;">Las contraseñas no coinciden</div>\n              <div style="margin-top: 10px;">\n                  <label><input type="checkbox" id="showPassword"> Mostrar contraseñas</label>\n              </div>\n            `,confirmButtonText:"Guardar",focusConfirm:!1,customClass:{popup:"mi-popup-central"},preConfirm:()=>{const e=document.getElementById("pass1").value,o=document.getElementById("pass2").value;return e&&o?e!==o?(document.getElementById("errorText").style.display="block",!1):(Swal.showLoading(),e):(Swal.showValidationMessage("Debes completar ambos campos"),!1)}}).then((e=>{e.isConfirmed&&e.value&&(Swal.fire({title:"Actualizando...",text:"Por favor, espera mientras actualizamos tu contraseña.",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading()}}),$.ajax({type:"POST",url:"./Modules/Global/Models/UpdatePassword.php",data:{correo:a,token:o,password:e.value},success:function(e){e.success?Swal.fire({title:"Éxito",text:"Tu contraseña ha sido actualizada",icon:"success",customClass:{popup:"mi-popup-central"},didClose:()=>{localStorage.setItem("abrirOffcanvas","1"),window.location.href="/inicio"}}):Swal.fire("Error",e.message||"Ocurrió un error","error")},error:function(e){window.location.href="/500"}}))})),document.getElementById("showPassword").addEventListener("change",(function(){const e=document.getElementById("pass1"),o=document.getElementById("pass2");this.checked?(e.type="text",o.type="text"):(e.type="password",o.type="password")}))):mostrarTokenInvalido(e.message,a)},error:function(){Swal.fire({icon:"error",title:"Oops...",text:"Ha ocurrido un error al verificar el vínculo.",confirmButtonText:"OK",customClass:{popup:"mi-popup-central"}})}})}));