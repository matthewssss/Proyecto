let comunidadId=null,provinciaId=null;function loadFormMovement(){var a=$("div.setup-panel div a"),o=$(".setup-content"),e=$(".nextBtn"),n=$(".prevBtn");o.hide(),a.on("click",(function(e){e.preventDefault();var n=$($(this).attr("href")),i=$(this);i.hasClass("disabled")||(a.removeClass("btn-primary").addClass("btn-default"),a.parent().find("p").removeClass("active-step"),i.addClass("btn-primary"),i.parent().find("p").addClass("active-step"),o.hide(),n.show(),n.find("input:eq(0)").focus())})),n.on("click",(function(){var a=$(this).closest(".setup-content").attr("id"),o=$('div.setup-panel div a[href="#'+a+'"]').parent().prev().children("a");$('div.setup-panel div a[href="#'+a+'"]').addClass("completed-step"),o.removeAttr("disabled").trigger("click")})),e.on("click",(function(){var a=$(this).closest(".setup-content"),o=a.attr("id"),e=$('div.setup-panel div a[href="#'+o+'"]').parent().next().children("a"),n=a.find("input[type='text'],input[type='url'],input[type='email'],input[type='date'],select");$(".form-group").removeClass("has-error");for(var i=0;i<n.length;i++)n[i].validity.valid||$(n[i]).closest(".form-group").addClass("has-error");$("#asociadoForm").valid()&&($('div.setup-panel div a[href="#'+o+'"]').addClass("completed-step"),e.removeAttr("disabled").trigger("click"))})),$("div.setup-panel div a.btn-primary").trigger("click")}function cargarSelectQuery(){$("#comunidad_autonoma").select2({placeholder:"Selecciona una Comunidad Autónoma",allowClear:!0,dropdownCssClass:"custom-dark-dropdown",containerCssClass:"custom-dark-container"}),$("#provincia").select2({placeholder:"Selecciona una Provincia",allowClear:!0,dropdownCssClass:"custom-dark-dropdown",containerCssClass:"custom-dark-container"}),$("#municipio").select2({placeholder:"Selecciona un Municipio",allowClear:!0,dropdownCssClass:"custom-dark-dropdown",containerCssClass:"custom-dark-container"}),$("#comunidad_autonoma").on("change",(function(){setTimeout((function(){comunidadId=$("#comunidad_autonoma").val(),0!=comunidadId&&loadProvincias(comunidadId)}),500)})),$("#provincia").on("change",(function(){setTimeout((function(){provinciaId=$("#provincia").val(),0!=provinciaId&&loadMunicipios(provinciaId)}),500)}))}function loadComunidades(){$.ajax({url:"../Controllers/Servlet.php?action=getComunidades",type:"GET",dataType:"json",success:function(a){if(a.error)console.log("No se encontraron comunidades."),console.log(a);else{var o=$("#comunidad_autonoma");o.empty(),o.append('<option value="" disabled selected>Selecciona una comunidad autónoma</option>'),$.each(a.msg,(function(a,e){o.append('<option value="0'+e.id+'">'+e.nombre+"</option>")}))}},error:function(a,o,e){}})}function loadProvincias(){$.ajax({url:"../Controllers/Servlet.php?action=getProvincias&comunidadId="+comunidadId,type:"GET",dataType:"json",success:function(a){if(a.error)console.log("No se encontraron provincias."),console.log(a);else{var o=$("#provincia");o.empty(),o.append('<option value="0" disabled selected>Selecciona una provincia</option>'),$.each(a.msg,(function(a,e){o.append('<option value="'+e.id+'">'+e.nombre+"</option>")}))}},error:function(a,o,e){}})}function loadMunicipios(){$.ajax({url:"../Controllers/Servlet.php?action=getMunicipios&provinciaId="+provinciaId,type:"GET",dataType:"json",success:function(a){if(a.error)console.log("No se encontraron municipios."),console.log(a);else{var o=$("#municipio");o.empty(),o.append('<option value="0" disabled selected>Selecciona un municipio</option>'),$.each(a.msg,(function(a,e){o.append('<option value="'+e.id+'">'+e.nombre+"</option>")}))}},error:function(a,o,e){}})}function cargarEvento(a){const o=$("#tooltipSimulado"),e=$("#guardarDatos");e.on("mouseenter mousemove",(function(a){!function(a){const e=cargarMensajes();if(e.length>0){let n="<b>Errores detectados:</b><br>"+e.join("<br>");o.html(n).show().css({top:a.pageY-o.outerHeight()-10+"px",left:a.pageX-10+"px"})}else o.hide()}(a)})),e.on("mouseleave",(function(){o.hide()})),e.on("click",(function(a){a.preventDefault();const e=cargarMensajes();if(e.length>0){a.preventDefault();let n="<b>Errores detectados:</b><br>"+e.join("<br>");return o.html(n).show().css({top:"27rem",left:"3rem"}),!1}!function(){Swal.fire({title:"Guardando cambios...",text:"Por favor, espera un momento.",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{Swal.showLoading()}});const a={action:"insertData",nombre:$("#nombre").val(),apellidos:$("#apellidos").val(),dni:$("#DNI").val(),fecha_nacimiento:$("#fecha_nacimiento").val(),edad:$("#edad").val(),unidad:$("#unidad").val(),municipio:$("#municipio").val(),provincia:$("#provincia").val(),comunidad_autonoma:$("#comunidad_autonoma").val(),nombre_padre:$("#nombre_padre").val(),apellidos_padre:$("#apellidos_padre").val(),dni_padre:$("#dni_padre").val(),correo_padre:$("#correo_padre").val(),telefono_padre:$("#telefono_padre").val(),estado_civil:$("#estado_civil").val()};$.ajax({url:"../Controllers/Servlet.php",type:"POST",data:a,dataType:"json",success:function(a){const o=bootstrap.Modal.getInstance(document.getElementById("exampleModal"));o&&o.hide(),a.error?Swal.fire({toast:!0,position:"top",icon:"error",title:a.message||"Ha ocurrido un error",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}):(localStorage.setItem("toastAction","new"),window.parent.location.reload())},error:function(a){window.top.location.href="/500"}})}()}))}function cargarMensajes(){let a=[];$("#nombre").val().trim()?$("#nombre").val().trim():a.push("Nombre vacío"),$("#apellidos").val().trim()?$("#apellidos").val().trim():a.push("Apellidos vacío"),$("#DNI").val().trim()?$("#DNI").val().trim():a.push("DNI vacío"),$("#fecha_nacimiento").val().trim()?$("#fecha_nacimiento").val().trim():a.push("Fecha de nacimiento vacía"),$("#edad").val().trim()?$("#edad").val().trim():a.push("Edad vacía"),$("#unidad").val().trim()?$("#unidad").val().trim():a.push("Unidad vacía"),0!=$("#municipio").val()?$("#municipio").val():a.push("Municipio vacío"),0!=$("#provincia").val()?$("#provincia").val():a.push("Provincia vacía"),0!=$("#comunidad_autonoma").val()?$("#comunidad_autonoma").val():a.push("Comunidad Autónoma vacía"),$("#nombre_padre").val().trim()?$("#nombre_padre").val().trim():a.push("Nombre del padre vacío"),$("#apellidos_padre").val().trim()?$("#apellidos_padre").val().trim():a.push("Apellidos del padre vacío"),$("#dni_padre").val().trim()?$("#dni_padre").val().trim():a.push("DNI del padre vacío"),$("#correo_padre").val().trim()?$("#correo_padre").val().trim():a.push("Correo del padre vacío"),$("#telefono_padre").val().trim()?$("#telefono_padre").val().trim():a.push("Teléfono del padre vacío"),$("#estado_civil").val().trim()?$("#estado_civil").val().trim():a.push("Estado civil vacío");return a}jQuery((function(){loadFormMovement(),cargarSelectQuery(),loadComunidades(),cargarEvento()}));