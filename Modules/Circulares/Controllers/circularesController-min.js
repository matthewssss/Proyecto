const eventsData=loadEvents();let iso;function loadEvents(){$.ajax({url:"../Controllers/Servlet.php",method:"GET",data:{action:"getEvents"},dataType:"json",success:function(e){return loadData(),e},error:function(e,t,o){window.location.href="/500"}})}function loadData(){$.ajax({url:"../Controllers/Servlet.php",method:"GET",data:{action:"loadFiles"},dataType:"json",success:function(e){$("#cards-ramas").html(e.recientes),$("#circulares").html(e.todas),isotope(),$("#filtroMes").select2(),fullCalendar(),document.getElementById("filtroTodos").checked=!0,document.querySelectorAll(".filtro-rama").forEach((e=>e.checked=!0));window.innerWidth<992||applyFilters(),setTimeout((()=>{iso.isotope({"data-fecha":!0})}),100),$(".shareBtnClass").on("click",(function(){const e=this.getAttribute("data-path");navigator.share?navigator.share({title:document.title,url:e}).then((()=>{console.log("Contenido compartido con éxito")})).catch((e=>{console.log("Error al compartir",e)})):alert("Tu navegador no soporta la función de compartir, pero puedes copiar el enlace: "+e)})),e.idRol&&($("#buttonCreate").html('<button class="btn btn-primary btnPrincipal" id="createCircular">Crear circular</button>'),$("#createCircular").on("click",openCircularModal))},error:function(e,t,o){window.location.href="/500"}})}function isotope(){iso=$("#circulares").isotope({itemSelector:".circular",layoutMode:"fitRows",getSortData:{"data-fecha":"[data-fecha]","data-pernoctas":"[data-pernoctas] parseInt","data-rama":"[data-rama]","data-titulo":"[data-titulo]","custom-rama":function(e){return{Lobatos:1,Exploradores:2,Pioneros:3,General:4}[e.getAttribute("data-rama")||"General"]||99}}}),$("#filtroMes").on("change.select2",applyFilters),document.querySelectorAll(".filtro-rama").forEach((e=>{e.addEventListener("change",(()=>{document.getElementById("filtroTodos").checked=Array.from(document.querySelectorAll(".filtro-rama")).every((e=>e.checked)),applyFilters()}))})),document.getElementById("filtroTodos").addEventListener("change",(e=>{const t=e.target.checked;document.querySelectorAll(".filtro-rama").forEach((e=>e.checked=t)),applyFilters()})),document.getElementById("ordenarPor").addEventListener("change",(function(){sortBy(this.value)}))}function applyFilters(){const e=window.innerWidth<992,t=document.getElementById("filtroMesModal"),o=document.getElementById("filtroMes");let a=null;if(t){const e=t.value;a=e?parseInt(e,10):null}else if(o){const e=o.value;a=e?parseInt(e,10):null}let n=[],l=!0,r=[];e&&document.querySelectorAll(".filtro-rama-modal").length?(l=document.getElementById("filtroTodosModal").checked,r=document.querySelectorAll(".filtro-rama-modal")):!e&&document.querySelectorAll(".filtro-rama").length&&(l=document.getElementById("filtroTodos").checked,r=document.querySelectorAll(".filtro-rama")),!l&&r.length&&(n=Array.from(r).filter((e=>!e.checked)).map((e=>e.value)));const c=e?document.getElementById("searchAsociadoModal"):document.getElementById("searchAsociado"),i=c?c.value.trim().toLowerCase():"";let d;iso.isotope({filter:function(){const e=$(this),t=e.data("rama")?e.data("rama").toLowerCase():"",o=e.data("mes"),r=e.data("lugar")?e.data("lugar").toLowerCase():"",c=e.data("pernoctas")?String(e.data("pernoctas")).toLowerCase():"",d=e.data("titulo")?e.data("titulo").toLowerCase():"",s=l||!n.includes(e.data("rama")),u=null===a||parseInt(o)===a,m=""===i||t.includes(i)||r.includes(i)||c.includes(i)||d.includes(i);return s&&u&&m}}),clearTimeout(d),d=setTimeout((()=>{const e=document.querySelectorAll('#circulares .circular:not([style*="display: none"])');document.getElementById("sinResultados").style.display=0===e.length?"block":"none"}),500)}function fullCalendar(){$.ajax({url:"../Controllers/Servlet.php",method:"GET",data:{action:"getEvents"},dataType:"json",success:function(e){const t=document.getElementById("calendario");new FullCalendar.Calendar(t,{headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,listWeek"},views:{listWeek:{type:"list",duration:{days:30},buttonText:"Lista"}},initialDate:(new Date).toISOString().split("T")[0],editable:!0,locale:"es",selectable:!0,events:e}).render()},error:function(e,t,o){document.getElementById("calendario").text("No se pudo cargar el calendario")}})}function sortBy(e){let t="data-fecha",o=!0;"fechaAsc"===e?(t="data-fecha",o=!0):"fechaDesc"===e?(t="data-fecha",o=!1):"pernoctas"===e?(t="data-pernoctas",o=!1):"rama"===e?(t="custom-rama",o=!0):"titulo"===e&&(t="data-titulo",o=!1),iso.isotope({sortBy:t,sortAscending:o})}function loadEventsMobile(){document.getElementById("ordenarPorMobile").addEventListener("change",(function(){sortBy(this.value)})),document.getElementById("searchAsociadoModal").addEventListener("input",(function(){let e;clearTimeout(e),e=setTimeout((()=>{applyFilters()}),300)})),document.getElementById("resetSearchAsociadoModal").addEventListener("click",(()=>{document.getElementById("searchAsociadoModal").value="",applyFilters()})),document.getElementById("btnFiltros").addEventListener("click",loadFilterModal)}function loadFilterModal(){Swal.fire({title:"Filtros",html:'\n            <div>\n                <h5>Filtrar por mes</h5>\n                <select id="filtroMesModal">\n                    <option value="">Todos</option>\n                    <option value="1">Enero</option>\n                    <option value="2">Febrero</option>\n                    <option value="3">Marzo</option>\n                    <option value="4">Abril</option>\n                    <option value="5">Mayo</option>\n                    <option value="6">Junio</option>\n                    <option value="7">Julio</option>\n                    <option value="8">Agosto</option>\n                    <option value="9">Septiembre</option>\n                    <option value="10">Octubre</option>\n                    <option value="11">Noviembre</option>\n                    <option value="12">Diciembre</option>\n                </select>\n            </div>\n            <div>\n                <h5>Filtrar por rama</h5>\n                <input type="checkbox" id="filtroTodosModal" checked> Todas las unidades<br>\n                <input type="checkbox" class="filtro-rama-modal" value="Lobatos" checked> Lobatos<br>\n                <input type="checkbox" class="filtro-rama-modal" value="Exploradores" checked> Exploradores<br>\n                <input type="checkbox" class="filtro-rama-modal" value="Pioneros" checked> Pioneros<br>\n            </div>\n        ',showCancelButton:!0,confirmButtonText:"Aplicar filtros",cancelButtonText:"Cancelar",didOpen:()=>{document.getElementById("filtroTodosModal").addEventListener("change",(function(){const e=this.checked;document.querySelectorAll(".filtro-rama-modal").forEach((t=>t.checked=e))})),document.querySelectorAll(".filtro-rama-modal").forEach((e=>{e.addEventListener("change",(function(){const e=Array.from(document.querySelectorAll(".filtro-rama-modal")).every((e=>e.checked));document.getElementById("filtroTodosModal").checked=e}))}))},preConfirm:()=>{applyModalFilters()}})}function applyModalFilters(){const e=document.getElementById("filtroMesModal").value,t=e?parseInt(e,10):null,o=document.getElementById("filtroTodosModal").checked,a=[];o||document.querySelectorAll(".filtro-rama-modal").forEach((e=>{e.checked||a.push(e.value)}));const n=document.getElementById("searchAsociadoModal").value.trim().toLowerCase();iso.isotope({filter:function(){const e=$(this),l=e.data("rama")?e.data("rama").toLowerCase():"",r=e.data("mes"),c=e.data("lugar")?e.data("lugar").toLowerCase():"",i=e.data("pernoctas")?String(e.data("pernoctas")).toLowerCase():"",d=e.data("titulo")?e.data("titulo").toLowerCase():"",s=o||!a.includes(e.data("rama")),u=null===t||parseInt(r)===t,m=""===n||l.includes(n)||c.includes(n)||i.includes(n)||d.includes(n);return s&&u&&m}}),document.querySelectorAll(".filtro-rama").forEach((e=>{const t=document.querySelector(`.filtro-rama-modal[value="${e.value}"]`);t&&(e.checked=t.checked)}));const l=Array.from(document.querySelectorAll(".filtro-rama")).every((e=>e.checked));document.getElementById("filtroTodos").checked=l,applyFilters()}jQuery((function(){document.getElementById("searchAsociado").addEventListener("input",(function(){let e;clearTimeout(e),e=setTimeout((()=>{applyFilters()}),300)})),document.getElementById("resetSearchAsociado").addEventListener("click",(()=>{document.getElementById("searchAsociado").value="",applyFilters()})),loadEventsMobile()}));