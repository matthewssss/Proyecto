function cargarPermisos(){$.ajax({url:"../Controllers/Servlet.php",method:"POST",data:{action:"getSession"},dataType:"json",success:function(t){t.exits?cargarDatos(!0):window.location.href="/403"},error:function(t,o,a){window.location.href="/500"}})}function cargarDatos(t){$.ajax({url:"../Controllers/Servlet.php",method:"POST",data:{action:"getAllData"},dataType:"json",success:function(o){o.success?($("#tablaNoEnviados tbody").html(o.no_enviados),$("#tablaEnviados tbody").html(o.enviados),$("#tablaEliminados tbody").html(o.eliminados),t&&(inicializarTabla("#tablaNoEnviados"),inicializarTabla("#tablaEnviados"),inicializarTabla("#tablaEliminados"),loadEvents())):console.error("Error al cargar los datos:",o.message)},error:function(t,o,a){window.location.href="/500"}})}function inicializarTabla(t){$(t).DataTable({responsive:!0,language:{url:"//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json",zeroRecords:"No se encontraron resultados.",emptyTable:"No hay datos disponibles."},paging:!1,lengthChange:!1,searching:!0,ordering:!0,info:!1,autoWidth:!1,order:[[0,"asc"]]})}function loadEvents(){function t(t){const o=$(t).closest("tr");return{id:o.data("id"),titulo:o.data("titulo"),path:o.data("path"),pernoctas:o.data("pernoctas"),fechaInicio:o.data("fecha-inicio"),fechaFin:o.data("fecha-fin"),rama:o.data("rama"),ubicacion:o.data("ubicacion")}}$(document).on("click",".action-menu",(function(){var t=$(this).closest("tr").find(".action-dropdown");t.toggle(),$(document).on("click",(function(o){$(o.target).closest(".action-menu").length||t.hide()}))})),$(document).on("click",".btn-ver",(function(){var t=$(this).closest("tr"),o=t.data("titulo"),a=t.data("path");Swal.fire({title:o,html:` \n                <iframe src="${a}" width="100%" height="500px" frameborder="0"></iframe>\n                <div class="mt-3 text-center">\n                    <button id="download-btn" class="btn btn-primary btnPrincipal">Descargar Circular</button>\n                    <button id="close-btn" class="btn btn-secondary btnPrincipal">Cerrar</button>\n                </div>\n            `,width:"80%",showCloseButton:!0,showConfirmButton:!1,willOpen:()=>{$("#download-btn").on("click",(function(){var t=document.createElement("a");t.href=a,t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t)})),$("#close-btn").on("click",(function(){Swal.close()}))}})})),$(document).on("click",".btn-borrar",borrarModal),$(document).on("click",".btn-enviar",enviarCircular),$(document).on("click",".btn-descargar",(function(){var t=$(this).closest("tr").data("path"),o=document.createElement("a");o.href=t,o.download="",document.body.appendChild(o),o.click(),document.body.removeChild(o)})),$(document).on("click",".btn-editar",(function(){const o=t(this);openCircularModal("editar",o)})),$(document).on("click",".btn-clonar",(function(){const o=t(this);openCircularModal("clonar",o)})),$("#btn-crear-circular").on("click",openCircularModal)}function borrarModal(){var t=$(this).closest("tr"),o=t.data("id"),a=t.data("titulo");Swal.fire({title:"¿Estás seguro?",text:"¡Tu circular '"+a+"' se borrará, puedes ir a la pestaña de eliminados y revertirlo en cualquier momento.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, borrar",cancelButtonText:"Cancelar",customClass:{icon:"mi-popup-central"}}).then((t=>{t.isConfirmed&&$.ajax({url:"../Controllers/Servlet.php",type:"POST",dataType:"json",data:{action:"deleteFirstTime",id:o},success:function(t){"success"===t.status?Swal.fire({title:"¡Eliminado!",text:"La circular ha sido eliminada correctamente.",icon:"success",confirmButtonText:"Aceptar",customClass:{icon:"mi-popup-central"}}).then((()=>{cargarDatos(!1)})):Swal.fire({title:"Error",text:"Hubo un problema al eliminar la circular.",icon:"error",confirmButtonText:"Aceptar",customClass:{icon:"mi-popup-central"}})},error:function(t,o,a){Swal.fire({title:"Error",text:"Hubo un error en la conexión.",icon:"error",confirmButtonText:"Aceptar",customClass:{icon:"mi-popup-central"}})}})}))}function enviarCircular(){var t=$(this).closest("tr").data("id");Swal.fire({title:"¿Estás seguro de enviar esta circular?",text:"¿Confirmas el envío de esta circular? Los usuarios serán notificados y no podrás volver a editarla.",icon:"question",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#d33",confirmButtonText:"Sí, enviar",cancelButtonText:"Cancelar",customClass:{icon:"mi-popup-central"}}).then((o=>{o.isConfirmed&&(Swal.fire({title:"Enviando circular...",text:"Por favor espera mientras procesamos la solicitud.",allowOutsideClick:!1,showConfirmButton:!1,customClass:{icon:"mi-popup-central"},onOpen:()=>{Swal.showLoading()}}),$.ajax({url:"../Controllers/Servlet.php",method:"POST",data:{action:"enviarCircular",id:t},success:function(t){console.log(t),Swal.fire({toast:!0,position:"top",icon:"success",title:"La circular ha sido enviada correctamente.",showConfirmButton:!1,timer:3500,timerProgressBar:!0,customClass:{popup:"swal2-toast-custom"}}).then((()=>{cargarDatos(!1)}))},error:function(){Swal.fire({title:"Error",text:"No se pudo enviar la circular.",icon:"error",confirmButtonText:"Aceptar",customClass:{icon:"mi-popup-central"}})}}))}))}jQuery((function(){cargarPermisos()}));