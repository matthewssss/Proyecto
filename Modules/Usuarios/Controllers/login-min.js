function cargarBotones(){$(".form").find("input, textarea").on("keyup blur focus",(function(e){var t=$(this);e.preventDefault(),label=t.prev("label"),"keyup"===e.type?""===t.val()?label.removeClass("active highlight"):label.addClass("active highlight"):"blur"===e.type?""===t.val()?label.removeClass("active highlight"):label.removeClass("highlight"):"focus"===e.type&&(""===t.val()?label.removeClass("highlight"):""!==t.val()&&label.addClass("highlight"))})),$(".tab a").on("click",(function(e){clearForm(e),e.preventDefault(),"goBack"!=$(this)[0].id?($(this).parent().addClass("active"),$(this).parent().siblings().removeClass("active"),target=$(this).attr("href"),$(".tab-content > div").not(target).hide(),$(target).fadeIn(600)):restoreLinks()}))}function validarEmail(e,t){let o;Swal.fire({title:"Cargando...",text:"Por favor espera",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading()}}),t.preventDefault();let a=!1;"signup"===e?(o=document.getElementById("id_email_logup").value,a=$("#signin").valid()):"forgot"===e?(o=document.getElementById("id_email_forgot").value,a=$("#resetPassword").valid()):(o=document.getElementById("id_email").value,a=$("#loginForm").valid()),a&&$.ajax({url:"../Controllers/Servlet.php?action=checkEmail&email="+o+"&recovery="+e,type:"GET",dataType:"json",success:function(o){"login"===e||"forgot"===e?o.exists?"login"===e?loginUsr():forgotPassword(o):($(".errorLog").text(o.message),showSweetToast("warning","Correo electrónico no encontrado")):"signup"===e&&(o.exists?($(".errorLog").text("Correo electronico ya registrado"),showSweetToast("warning","Correo electrónico ya registrado")):signInUsr(t))},error:function(e){showSweetToast("error","Error en la verificación del email")}})}function loginUsr(){const e=document.getElementById("id_email").value,t=document.getElementById("id_psw0").value;$.ajax({url:"../Controllers/Servlet.php",type:"GET",data:{action:"login",email:e,password:t},dataType:"json",success:function(e){if(e.error)$(".errorLog").text(e.message),showSweetToast("error",e.message);else if("factor"===e.status)mostrarModalDobleFactor();else{let e="/Modules/Usuarios/View/";window.parent.document.getElementById("userIframe").src=e+"profileMenu.html"}},error:function(e){window.top.location.href="/500"}})}function mostrarModalDobleFactor(){Swal.fire({title:"Introduce el código de verificación",input:"text",inputPlaceholder:"Código de 6 dígitos",inputAttributes:{maxlength:6,minlength:6},showCancelButton:!0,confirmButtonText:"Verificar",cancelButtonText:"Cancelar",customClass:{popup:"mi-popup-central"},preConfirm:e=>e?/^\d{6}$/.test(e)?$.ajax({url:"../Controllers/Servlet.php",type:"POST",data:{action:"login2",codigo:e},dataType:"json",success:function(e){e.error?Swal.fire({icon:"error",title:"Error",text:e.message,confirmButtonText:"Reintentar"}):Swal.fire({icon:"success",title:e.message,confirmButtonText:"OK"}).then((()=>{window.parent.document.getElementById("userIframe").src="/Modules/Usuarios/View/profileMenu.html",window.parent.document.getElementById("userIframe").classList.add("login")}))},error:function(e,t,o){Swal.fire({icon:"error",title:"Oops...",text:"Ha ocurrido un error al verificar el código.",confirmButtonText:"OK"})}}):(Swal.showValidationMessage("El código debe ser de 6 dígitos"),!1):(Swal.showValidationMessage("Por favor, ingresa un código"),!1)})}function cambiarIframe(e){let t=window.parent.document.getElementById("userIframe");t.style.scale="0",t.src=e}function signInUsr(e){const t=document.getElementById("id_email_logup").value,o=document.getElementById("id_name").value,a=document.getElementById("id_apellido").value,s=document.getElementById("id_psw1").value,n=document.getElementById("id_tlf").value;$.ajax({url:"../Controllers/Servlet.php",type:"POST",data:{action:"signin",name:o,lastname:a,email:t,tlf:n,pass:s},dataType:"json",success:function(t){t.error?($(".errorLog").text(t.message),showSweetToast("error",t.message)):(showSweetToast("success",t.message),clearForm(e),goBackToLogin())},error:function(e){window.top.location.href="/500"}})}function goBackToLogin(){$("#login, #signup, #forgot").removeClass("active"),$("#login").addClass("active"),$("#signup, #forgot").hide(),$("#login").fadeIn(600)}function showSweetToast(e="success",t="Operación realizada"){Swal.fire({toast:!0,position:"top",icon:e,title:t,showConfirmButton:!1,timer:3500,timerProgressBar:!0,customClass:{popup:"swal2-toast-custom"},didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}})}function forgotPassword(){Swal.fire({icon:"success",title:"Correo enviado",text:"Te hemos enviado un email con el código para restablecer tu contraseña. Revisa tu bandeja de entrada y también la carpeta de spam.",confirmButtonText:"Entendido",confirmButtonColor:"#6a1b9a",customClass:{popup:"swal2-toast-custom"}})}function showPasswordLogIn(e){e.preventDefault();const t=document.getElementById("password-display");this.checked?t.classList.add("show"):t.classList.remove("show")}function showPasswordValue(e){e.preventDefault();document.getElementById("password-display").textContent=this.value}function updatePopupPasswords(e){e.preventDefault();const t=document.getElementById("id_psw1").value,o=document.getElementById("id_psw2").value,a=document.getElementById("password-display1"),s=document.getElementById("password-display2");a.textContent=t,s.textContent=o}function showPasswordLogUp(e){e.preventDefault();const t=document.getElementById("password-display1"),o=document.getElementById("password-display2");this.checked?(t.classList.add("show"),o.classList.add("show")):(t.classList.remove("show"),o.classList.remove("show"))}function mostrarContraOlvidada(e){e.preventDefault();let t=$("#login"),o=$("#forgot");t.css("animation","flip 1s ease-in-out forwards"),o.css("animation","backflip 1s ease-in-out forwards"),o.css("display","block"),setTimeout((()=>{o.css("z-index","1"),t.css("z-index","-1")}),500),showGoBack()}function showGoBack(){let e=document.querySelector('a[href="#login"]'),t=document.querySelector('a[href="#signup"]');e&&(e.id="goBack",e.textContent="Volver atrás"),t&&(t.style.transform="scale(0)")}function restoreLinks(){let e=document.getElementById("goBack"),t=document.querySelector('a[href="#signup"]');e&&(e.setAttribute("href","#login"),e.id="",e.textContent="Iniciar sesión"),t&&(t.style.transform="scale(1)");let o=$("#login"),a=$("#forgot");a.css("animation","flip 1s ease-in-out forwards"),o.css("animation","backflip 1s ease-in-out forwards"),o.css("display","block"),setTimeout((()=>{o.css("z-index","1"),a.css("z-index","-1")}),500),setTimeout((()=>{o.css("animation","")}),1e3)}function clearForm(e){$("form input").val(""),$("#toggle-password-logup").prop("checked",!1),$("#toggle-password").prop("checked",!1),$(".password-display").empty(),$(".error").empty(),showPasswordLogIn(e),showPasswordLogUp(e),$(".tab").removeClass("active"),$('.tab a[href="#login"]').parent().addClass("active"),$(".tab-content > div").hide(),$("#login").fadeIn(600)}jQuery((function(){cargarBotones(),$("#id_login").on("click",(function(e){validarEmail("login",e)})),$("#id_logup").on("click",(function(e){validarEmail("signup",e)})),$("#id_forgot_psw").on("click",(function(e){validarEmail("forgot",e)})),document.getElementById("toggle-password").addEventListener("change",showPasswordLogIn),document.getElementById("id_psw0").addEventListener("input",showPasswordValue),document.getElementById("toggle-password-logup").addEventListener("change",showPasswordLogUp),document.getElementById("id_psw1").addEventListener("input",updatePopupPasswords),document.getElementById("id_psw2").addEventListener("input",updatePopupPasswords),$("#id_forgot").on("click",mostrarContraOlvidada)}));